<!DOCTYPE html>
<html>
<head>
<title>2404</title>
<style>
body {
	font-family: arial;
	margin-left: 80px;
}
p {
	font-size:24px;
}
pre {
	font-size:24px;
	font-family: 'Courier New';
}
hr {
	width: 100%;
	height: 2px;
	
	margin-top:10px;
	margin-bottom:10px
}
.header {
	text-align: center;
	font-weight: bold;
	font-size: 40px;
	
	margin-top:0px;
	margin-bottom:0px;
	
	color: rgb(153, 0, 0);
}
.subheader {
	color: #000099;
	
	margin-bottom:100px;
}
.segment-header {
	color: rgb(0, 0, 153);
	font-size: 30px;
}
.black-bold {
	color: rgb(0,0,0);
	font-weight: bold;
}
.glossary-term {
	font-weight: 700;
	color: #000099;
}
.code {
	font-family: 'Courier New';
}
.comment {
	color:rgb(0, 128, 0);
}
ul li {
	margin-bottom: 5px;
	font-size:24px;
}.red {
	color: #F00;
}
</style>
</head>

<body>
<p class="header">COMP 2404 - Fall 2019 Tutorial 05</p>
<p class="header subheader">Data Modeling with SQLite</p>
<hr/>
<p>&copy; L.D. Nel 2019</p>
<hr />
<p class="red">Rev 1: It is worth noting that the sqlite3.exe console app supports a .read command just like our assignment interface. It can be very convenient to write SQL querys in a text file and then use .read to execute them.
	</p>
<hr />
<p class="segment-header">Description:</p>
<p>The development client of our term project has decided they will use an SQLite database to house and persist the data about recordings and playlists. In this tutorial we will introduce you to using the SQLite command shell application that can be used to work with directly with SQLite relational databases. </p>
<p>SQLite is a small footprint, serverless relational database. It is the most popular database in the world. There are more instances of SQLite databases running than all other databases combined. The number of active SQLite databases is estimated to be in the trillions.</p>
<p>An SQLite database consists of a single file containg all its data. The SQLite sqlite3.exe command line  application allows you to access an sqlite database through a simple command line interface. From the shell you can execute both SQL commands on the data along with some useful shell specific &quot;dot&quot; commands (not unlike the ones we've been creating in our assignments).</p>
<p>This tutorial illustrates an application with a command line interface that is a popular way to directly access an SQLite database. Using this application you will create a script for the language we've designed in assignments 1 and 2. </p>
<p>In the next tutorial we will look at accessing the SQLite database directly from our C++ application code.</p>
<hr/>
<p class="segment-header">Installing sqlite3.exe Shell</p>
<p>SQLite should already be built into any Linux installation and is installed by default on the Mac. I've only ever downloaded the sqlite3.exe binary file for windows machines (described below).</p>
<p>To verify that the sqlite3.exe application is available on Linux or Mac open a terminal and exectute:</p>
<p class="code">sqlite3</p>
<p>For example on my Mac:</p>
<p><img src="images/00-1Install.png" width="662" height="150" alt=""/></p>
<p>&nbsp;</p>
<p>On my Linux subsystem on Windows 10 <span class="code">sqlite3</span> was not installed yet but I was prompted to do so with <span class="code">sudo apt install sqlite3</span>:</p>
<p><img src="images/00-2 sqlite_on_windows_ubuntu_shell.png" width="663" height="778" alt=""/></p>
<p>&nbsp;</p>
<p>Again sqlite3 is generally part of Mac and Linux by default. </p>
<p>The following describes downloading the sqlite3.exe binary to run locally on Windows. Regardless, you need to have this application installed on your platform to proceed with the tutorial.</p>
<p>&nbsp;</p>
<p>Installing SQLite command shell binary on Windows 10:</p>
<p>The <span class="code">sqlite3.exe</span> is available at: <a href="https://www.sqlite.org/download.html">https://www.sqlite.org/download.html</a> and download the precompiled binaries for sqlite-tools:</p>
<p><img src="images/00Install.png" width="1544" height="1184"></p>
<p>&nbsp;</p>
<p>Unzip the downloaded file and obtain the <span class="code">sqlite3.exe</span> file. Place it in the directory you want to work from with your database. In our case with the <span class="code">beatles.db</span> sample database.</p>
<p><img src="images/01Launch.png"></p>
<p>&nbsp;</p>
<hr>
<p class="segment-header">Opening the Beatles Data Database</p>
<p>The tutorial files contain a <span class="code">beatles.db</span> sqlite database file. This is the file you will open with the <span class="code">sqlite3.exe</span> command line application.</p>
<p class="red">From this point we assume you have the sqlite3.exe application installed and can run it.</p>
<p>&nbsp;</p>
<p>Execute <span class="code">sqlite3 beatles.db</span> to open the sqlite3 command interpreter on the <span class="code">beatles.db</span> database.</p>
<p><img src="images/02Launch.png" ></p>
<p>&nbsp;</p>
<p>(Alternatively you can just execute <span class="code">sqlite3</span> and then from within the shell open the beatles database with <span class="code">.open beatles.db</span>.)</p>
<p>&nbsp;</p>
<p>Now the database is open and you can operate on its data with SQL commands or use the dedicated shell &quot;dot&quot; commands. </p>
<p>SQL is the industry standard language for querying relational databases. On the other hand the &quot;dot&quot; commands are shell application command and have nothing to do with SQL.</p>
<p>See what tables the database consists of by executing <span class="code">.tables</span></p>
<p>&nbsp;</p>
<p><img src="images/03Tables.png" width="635" height="67"></p>
<p>&nbsp;</p>
<p>To see the available &quot;dot&quot; commands exectute <span class="code">.help</span></p>
<p><img src="images/05Help.png" width="947" height="657"></p>
<p>&nbsp;</p>
<p>Here is some &quot;getting started&quot; tutorial information about running the shell from the sqlite.org site: <a href="http://www.sqlite.org/cli.html">http://www.sqlite.org/cli.html</a></p>
<p>To see the schema of table <span class="code">songs</span> execute<span class="code"> .schema songs</span></p>
<p><img src="images/06Schema.png" width="824" height="72"></p>
<p>&nbsp;</p>
<p class="segment-header">Using SQL Commands</p>
<p>The following images show the E-R model of the <span class="code">beatles.db</span> database, a legend, and a diagram model of the database table schema. They are similar to those presented with Assignment 2. (Recall these have nothing to do with objects in the object-oriented programming sense.)</p>
<p>&nbsp;</p>
<p><img src="images/01ERModel.png" width="871" height="544"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><img src="images/01ERLegend.png" width="764" height="527" ></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Relational databases organize their data as tables. The schema of the <span class="code">beatles.db</span> database is shown below. The table schema shows the names of the tables and the columns and their headings for each  table. Underlined columns are the intended key for the table.</p>
<p><img src="images/02Schema.png"></p>
<p>&nbsp;</p>
<p>To select (and show) all the rows and columns of the <span class="code">recordings</span> table execute:<br>
  <br>
<span class="code">select * from recordings;</span></p>
<p>Note SQL commands don't start with a &quot;dot&quot; and always end in a semi-colon. (Because they end in semi-colon you can span them over multiple console input lines.) The following documentation on the sqlite.org site shows the SQL commands it supports and their syntax: <a href="http://www.sqlite.org/lang.html">http://www.sqlite.org/lang.html</a></p>
<p><img src="images/07Select.png" width="839" height="238"></p>
<p>&nbsp;</p>
<p>Notice the format is not very nice.</p>
<p>You can use the <span class="code">.mode column</span> and <span class="code">.header on</span> commands to put the output in column mode and show the column name header. Re-run the select command:</p>
<p><img src="images/08Header.png" width="842" height="305"></p>
<p>&nbsp;</p>
<p>You will notice from time to time some data is cut-off because of the column width. You can use the <span class="code">.width</span> command to set the width (in characters) of each column:</p>
<p><img src="images/09Width.png" width="857" height="290"></p>
<p>&nbsp;</p>
<p></p>
<hr>
<p class="segment-header">Problem 1</p>
<p>Recall in our assignments we invented a bash-style command for adding a song to the application:</p>
<p class="code">add -s &quot;The Girl From Ipanema&quot;</p>
<p>Here <span class="code">add</span> would be the command,the  <span class="code">-s</span> flag designates a song and <span class="code">&quot;The Girl From Ipanema&quot;</span>  the title of the song.</p>
<p>Suppose you wanted a script with all such commands to populate your app with the songs contained in the <span class="code">beatles.db</span> database. Here is a strategy you could follow:</p>
<p>1) Run an SQL query to find all the songs.</p>
<p>2) Format the query output to resemble your assignment command language.</p>
<p>3) Output the query result to a text file.</p>
<p>Lets do these steps:</p>
<p>Step 1) Execute the following query to list all the data in the songs table:</p>
<p class="code">select * from songs;</p>
<p><img src="images/10Songs.png" width="863" height="303"></p>
<p>(Only a few entries of the result are shown)</p>
<p>Next let's be selective and only select the song id and titles.</p>
<p class="code">select sid,title from songs;</p>
<p><img src="images/11Titles.png" width="734" height="174"></p>
<p>&nbsp;</p>
<p>Step 2)</p>
<p>Next we can output additional information with the select. Here we will only select the title of the song but concatenate &quot;add -s&quot; in front of it using the SQL || concatenation operator (notice in SQL strings are delimited by single quotes but in C++ strings are delimited by double quotes).</p>
<p class="code">select 'add -s ' || title from songs;</p>
<p>You may see something like the following because the mode is still column and the width is set too small:</p>
<p><img src="images/12WrongWidth.png"></p>
<p>Switch to list mode by executing <span class="code">.mode list</span> and then execute the SQL <span class="code">select * from songs;</span></p>
<p><img src="images/13ListMode.png" width="785" height="246"></p>
<p>Notice this time the song table &quot;columns&quot; are simply separated by a &quot;|&quot;.</p>
<p>Now use this mode to create your script commands:</p>
<p class="code">select 'add -s ' || title from songs;</p>
<p><img src="images/14Add.png" width="725" height="177"></p>
<p>&nbsp;</p>
<p>Remove the header column by executing <span class="code">.header off</span> (You are not going to want the column headers appearing in your script file.)</p>
<p><img src="images/15HeaderOff.png" width="623" height="215"></p>
<p>&nbsp;</p>
<p>Finally command language in our assignments requires that multi-word song titles be in double quotes.</p>
<p class="code">select 'add -s &quot;' || title || '&quot;' from songs;</p>
<p><img src="images/16Quotes.png" width="771" height="212"></p>
<p>&nbsp; </p>
<p>You have now output the data in the script format of our C++ assignment script language.</p>
<p>Step 3)</p>
<p>Finally lets write the script to a text file. Redirect the output to a text file by executing:</p>
<p class="code">.output songScript.txt</p>
<p>re-execute the select query</p>
<p class="code">select 'add -s &quot;' || title || '&quot;' from songs;</p>
<p>This time the output will not appear because a file <span class="code">songScript.txt</span> will have been created and the output directed to it.</p>
<p>Finally redirect the output back to stdout:</p>
<p class="code">.output stdout</p>
<p><img src="images/17Redirect.png" width="695" height="65"></p>
<p>&nbsp;</p>
<p>Your directory will not contain your script file:</p>
<p><img src="images/19Directory.png" width="847" height="142"></p>
<p>&nbsp;</p>
<p>Which should look like this:</p>
<p>&nbsp;</p>
<p><img src="images/20Script.png" width="589" height="294"></p>
<p>So you have just created a script in your C++ assignment language which could be used to populate your app with the same songs as the <span class="code">beatles.db</span> database.</p>
<p>Rev 1: Note the sqlite3.exe application also has a .read command which you can use to read and execute SQL statements from a text file.</p>
<hr>
<p>&nbsp;</p>
<p><span class="segment-header">Problem 2</span></p>
<p>&nbsp;</p>
<p>An E-R model shows where data from different entities (tables) can be safely joined together. The relationships, indicated by the diamond shapes, allow the entities they connect to be safely joined. Notice how tracks has a relationship to the song they are a recording of:</p>
<p><img src="images/21Tracks.png"></p>
<p>&nbsp;</p>
<p>Currently if you selected the information in the tracks table you would see:</p>
<p class="code">select * from tracks;</p>
<p class="code">&nbsp;</p>
<p><img src="images/22Tracks.png"></p>
<p>&nbsp;</p>
<p>However we want the song's title to also appear in the result. To do that we can run an SQL query that joins the tracks and songs entities along the attribute that forms the relationship.</p>
<p class="code">select albumID, songID, track_number, songs.title from songs join tracks on songID=sid;</p>
<p><img src="images/23SongTitle.png" width="958" height="174"></p>
<p>&nbsp;</p>
<p>Finally to show the album title along with the song title and  the track number where the song appears on the ablum you can join all three tables:</p>
<p class="code">select recordings.title, track_number, songs.title from songs join tracks on songID=sid join recordings on albumID=id;</p>
<p><img src="images/24AlbumTitle.png"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Repeat this process to show for each user's name the playlists they own. Then show for each user's playlist the songs that are on that playlist.</p>
<p>&nbsp;</p>
<p class="red">When you have completed these exercises show your work to the TA's to get credit for the tutorial.</p>
<p>&nbsp;</p>
</body>
</html>
